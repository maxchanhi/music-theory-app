<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Music Note App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
        }
    </style>

    <script type="text/javascript">
        function new_question() {
            window.location.href = "{{ url_for('new_question') }}";
        }
    </script>
    <script type="text/javascript">
        function submitDifficultyForm() {
            var form = document.getElementById('difficultyForm');
            form.submit();
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Music Note App</h1>
        <form action="{{ url_for('set_difficulty') }}" method="post" id="difficultyForm">
            <label for="difficulty">Choose difficulty:</label>
            <select name="difficulty" id="difficulty" onchange="submitDifficultyForm()">
                <option value="0" {% if session.get('difficulty') == 0 %}selected{% endif %}>Beginner</option>
                <option value="1" {% if session.get('difficulty') == 1 %}selected{% endif %}>Intermediate</option>
                <option value="2" {% if session.get('difficulty') == 2 %}selected{% endif %}>Advanced</option>
                <option value="3" {% if session.get('difficulty') == 3 %}selected{% endif %}>C clef Fanfare</option>
                <option value="4" {% if session.get('difficulty') == 4 %}selected{% endif %}>Expert</option>
                <option value="5" {% if session.get('difficulty') == 5 %}selected{% endif %}>Accidental Madness</option>
            </select>
        </form>
        <form action="{{ url_for('set_preferences') }}" method="post">
            <div class="row">
                <div class="col-sm-6">
                    <h3>Select Clefs:</h3>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" id="treble" name="clef_treble" value="treble" class="form-check-input" {% if session.get('clef_treble') %}checked{% endif %}>
                            <label for="treble" class="form-check-label">Treble</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="alto" name="clef_alto" value="alto" class="form-check-input" {% if session.get('clef_alto') %}checked{% endif %}>
                            <label for="alto" class="form-check-label">Alto</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="tenor" name="clef_tenor" value="tenor" class="form-check-input" {% if session.get('clef_tenor') %}checked{% endif %}>
                            <label for="tenor" class="form-check-label">Tenor</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="bass" name="clef_bass" value="bass" class="form-check-input" {% if session.get('clef_bass') %}checked{% endif %}>
                            <label for="bass" class="form-check-label">Bass</label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <h3>Select Accidentals:</h3>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="radio" id="natural" name="accidental" value="natural" class="form-check-input" {% if session.get('accidental', 'natural') == 'natural' %}checked{% endif %}>
                            <label for="natural" class="form-check-label">Natural Only</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" id="basic" name="accidental" value="basic" class="form-check-input" {% if session.get('accidental') == 'basic' %}checked{% endif %}>
                            <label for="basic" class="form-check-label">Basic Accidental</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" id="advanced" name="accidental" value="advanced" class="form-check-input" {% if session.get('accidental') == 'advanced' %}checked{% endif %}>
                            <label for="advanced" class="form-check-label">Advanced Accidental</label>
                        </div>
                    </div>
                </div>
            </div>
            <input type="hidden" name="selected_clefs" id="selected_clefs">
            <div class="text-center">
                <input type="submit" value="Save Preferences" class="btn btn-primary">
            </div>
            </div>
        </form>

        <div class="text-center mt-4">
            <img src="{{ image_path }}" alt="Music Note" class="img-fluid">
        </div>

        <div class="text-center mt-4">
            <form action="{{ url_for('check_answer') }}" method="post" class="form-inline justify-content-center">
                <div class="form-group mr-2">
                    <select name="user_quality" class="form-control">
                        {% for letter in user_quality %}
                        <option value="{{ letter }}">{{ letter }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group mr-2">
                    <select name="user_interval" class="form-control">
                        {% for acc in user_interval %}
                        <option value="{{ acc }}">{{ acc }}</option>
                        {% endfor %}
                    </select>
                </div>
                <input type="submit" value="Check Answer" class="btn btn-primary">
            </form>
        </div>

        <div class="text-center mt-4">
            <button onclick="new_question()" class="btn btn-secondary">New Question</button>
        </div>

        {% if feedback %}
        <div class="alert alert-info mt-4">
            <p>{{ feedback }}</p>
        </div>
        {% endif %}

        {% if correction_rate %}
        <div class="alert alert-success mt-4">
            <p>Correction Rate: {{ correction_rate|round(2) }}%</p>
        </div>
        {% endif %}
    </div>
    <script>
        // Update the hidden input field whenever a checkbox is checked or unchecked
        var clefCheckboxes = document.querySelectorAll('input[name^="clef_"]');
        var selectedClefsInput = document.getElementById('selected_clefs');
        
        clefCheckboxes.forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                var selectedClefs = Array.from(clefCheckboxes)
                    .filter(checkbox => checkbox.checked)
                    .map(checkbox => checkbox.value);
                selectedClefsInput.value = selectedClefs.join(',');
            });
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>